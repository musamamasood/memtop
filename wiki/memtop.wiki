#summary Displays memory consumption of processes in easy to read way.

= Introduction =

Python script for linux. Intended to help with diagnose and identification which processes uses most of RAM of PC.

Typical situation is when you need to reduce RAM usage of your box or you want to monitor your system for longer period of time to find out misbehaving applications. 

The script calculates amount of private/writeable for each process (using /proc/$PID/maps files) and prints biggest ones. It completely ignores private/non-writeable and shared memory. The reasons are:

  * shared memory is hard to interpret and at the end you still can not say 'how much memory is proces x taking'.
  * when tracking memory use of a process over time, private/writeable memory is most iteresting portion of process's memory use. Memtop will help you to find out how it changes over time. Also keep in mind that problems like memory leaks will be shown just in this number...
  * private/writeable memory is supposed to be an amount that will be freed in 'memory' (here the term includes both: RAM and swap) when process terminates
  * there are other tools to show this kind of info (shared memory use), so there is no need to have it included also here


In addition to pure listing of processes and their memory use, it can track memory use in general way and help you identify periods when your system is short of RAM and how bad it is. For more info, scroll down to "Additional memory utilization info" section.



<br>

== Example of output ==
One example is better then ten lines of description
{{{
   PID |   private/writ. mem |command                                                       10 Apr 11:30:22
       |  current |  change  |(might be truncated)                                         (waiting 1 min.)
 18005 | 400.9 MB |    +     |/opt/firefox-10/firefox                                                      
  8530 |  91.0 MB |          |/usr/lib/virtualbox/VirtualBox --comment ArchLin --startvm 7ed0ed70-e8c6-4b8a
  3187 |  69.4 MB |          |tea                                                                          
  2663 |  57.6 MB |          |xfce4-terminal                                                               
 30024 |  55.6 MB |          |/usr/lib/openoffice/program/soffice.bin -writer -splash-pipe=5               
  2724 |  51.3 MB |          |geany                                                                        
 18253 |  47.8 MB |          |/opt/firefox-10/plugin-container /usr/lib/flashplayer-mozilla/libflashplayer.
  1726 |  26.7 MB |          |/usr/bin/X :0 -audit 0 -auth /var/lib/gdm/:0.Xauth -nolisten tcp vt7         
  1578 |  24.9 MB |          |/usr/sbin/rsyslogd -c4                                                       
 24192 |  23.1 MB |          |/usr/lib/virtualbox/VirtualBox                                               
   Writeable/RAM: ===============================  80.0%
   RAM use without cached pages: 43.4% , SWAP use: 19.9%                 # enabled with -m option
   Swapping: 0.0 / 0.0, Paging: 0.0 / 6.2 (in/out / sec / period)        # enabled with -m option

   PID |   private/writ. mem |command                                                       10 Apr 11:31:21
       |  current |  change  |(might be truncated)                                         (waiting 1 min.)
 18005 | 382.1 MB | ---      |/opt/firefox-10/firefox                                                      
  8530 |  91.0 MB |          |/usr/lib/virtualbox/VirtualBox --comment ArchLin --startvm 7ed0ed70-e8c6-4b8a
  3187 |  69.4 MB |          |tea                                                                          
  2663 |  57.6 MB |          |xfce4-terminal                                                               
 30024 |  55.6 MB |          |/usr/lib/openoffice/program/soffice.bin -writer -splash-pipe=5               
  2724 |  51.3 MB |          |geany                                                                        
 18253 |  47.8 MB |          |/opt/firefox-10/plugin-container /usr/lib/flashplayer-mozilla/libflashplayer.
  1726 |  26.7 MB |          |/usr/bin/X :0 -audit 0 -auth /var/lib/gdm/:0.Xauth -nolisten tcp vt7         
  1578 |  24.9 MB |          |/usr/sbin/rsyslogd -c4                                                       
 24192 |  23.1 MB |          |/usr/lib/virtualbox/VirtualBox                                               
   Writeable/RAM: ==============================  78.8%
   RAM use without cached pages: 43.0% , SWAP use: 19.9%
   Swapping: 0.0 / 0.0, Paging: 0.0 / 3.3 (in/out / sec / period)
}}}

This example shows "graph" mode, and here the third column "previous" indicates change against previous iteration. It is just to visualise what program (its RAM occupation) is growing or shrinking.

<br>

== Use ==

No installation is needed, just run the script. Available parameters are

|| -p $integer   ||wait time between iterations (in minutes)||
||-s graph|numb||two alternatives how to present mainly data from former iteration||
|| -l $integer||number of lines - processes to show||
||-m ||more info about memory utilization (since 0.9.4)||
|| -L || log data to file, see section about graphs below||
||-h||help||



Important note: The script should be *run as root* or you will not get data for processes running under other users.

<br>

== Additional memory utilization info, introduced from 0.9.4 ==

From this release you can use swith "-m" / "-more" to get two additional lines, see example above.

While "writeable" information can be used to track memory use of single processes, especially memory leaks and so, "RAM use without cached pages" gives single number of your physical RAM utilization. It based on /proc/meminfo and consideres three lines:

  * Memtotal - as size of your RAM
  * Memfree  - as free portion of RAM
  * Cached   - "...in-memory cache for files read from the disk..." - this portion of RAM is not reported as free (not included in MemFree) but due to the character of data, kernel can drop stored data immediately and use freed capacity as needed

To calculate SWAP use it uses Swaptotal & Swapfree lines from /proc/meminfo.

Second new line and last one in the example is about swapping & paging. This information doesn't say "How full your RAM is" but monitors symptoms of RAM shortage. 


<br>

== Loging + Graphs from logs (from 0.9.6) ==

From 0.9.6 you can use swith -L/--log that will create file memtop.log in current directory, with content like:

{{{
##Date     time   wrtble ram   swap     pgin   pgout TopApp:PID writble(B)   command
10/04/2012 11:29   80.0  43.3  19.9      0.0     0.0   18005    419979264 /opt/firefox-10/firefox 
10/04/2012 11:30   80.0  43.4  19.9      0.0    6.18   18005    420384768 /opt/firefox-10/firefox 
10/04/2012 11:31   78.8  43.0  19.9      0.0     3.3   18005    400646144 /opt/firefox-10/firefox 
10/04/2012 11:32   78.8  43.0  19.9     1.72    1.72   18005    400646144 /opt/firefox-10/firefox 
10/04/2012 11:33   78.8  43.6  19.9      0.0   18.82   18005    401170432 /opt/firefox-10/firefox 
10/04/2012 11:34   78.8  43.8  19.9      0.0   19.63   18005    401367040 /opt/firefox-10/firefox 
}}}

The log provides the very same numbers as memtop prints out in console, but in a form that is easy to use with gnuplot, or f.e. import to office suite..



You can use my own gnuplot script (see download section, gnuplot needed) to use the log file. (memtop-graph-vX.gp expects memtop.log file in current directory)

{{{
   $ ./memtop-graph.pg > anyname.png    
}}}

and you can get image like this: 

http://memtop.googlecode.com/files/out.png

Obviously, nothing much special here. The box was idle most of time, just RAM utilization was growing steadily, this was caused by few instances of xfe leaking heapily. The drop on the end of graph happened when I killed those instances.



<br>

== Changes after 0.9.0 ==

After some three years I resumed my work on this tool, I "ported" it to python3 (still working with version 2.7 at least) and fixed problems when grepping its output. Sometimes it did not get through pipe at all (I dont understand why) but the main problem was that the grep command used to return error "Binary file matches". It showed that names of listed programs contained binary characters, not visible in console but still affecting grep.
Also I added info about swapping/pagging (see above) and made couple of cosmethic enhancements and internall house-keeping of the code.

<br>

**Any comments welcomed!!!**